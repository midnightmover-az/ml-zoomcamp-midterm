# Predict Heart Atack Risk

## Description of the problem: Predict Heart Atack Risk of a Patient Based on the patient features

## Data

The data originates from Kaggle, the URL for the downloading the data is below. The data is not real data, it has been generated by ChatGPT. The description of the data is available at the same URL.

Please note that this being generated data the quality of this data is not the best for training a system that gives realistic predictions.

The data has been uploaded to git, the file name is heart_attack_prediction_dataset.csv.

https://www.kaggle.com/datasets/iamsouravbanerjee/heart-attack-prediction-dataset


## Run with Docker

The application can be run the project using Docker. 
* Python3, git command line tool and Docker must be installed on the machine where the application is run
* Clone this project in a folder using the command below
```bash
               git clone https://github.com/midnightmover-az/ml-zoomcamp-midterm
```
* Change directory to the folder where the code was cloned with the above command
* Build the docker image using the command below
```bash
              docker build -t heart-atack-predictions .and:
```
* Run the application using Docker using the command below
```bash
              docker run -it -p 9696:9696 heart-atack-predictions:latest
```

You can test the application using this test command
```bash
              python3 predict-test.py
```
The above command makes two REST API calls first one, for a user that is older has higher risk and the second one for a user that is younger has a healthier lifestyle and has a lower risk. The output of the command looks like this:
```json
Test Patient Data:  {'age': 56, 'cholesterol': 500, 'heart_rate': 90, 'family_history': 1, 'smoking': 1, 'triglycerides': 220, 'blood_pressure_sistolic': 200}
{'heart_atack_risk': 0.3951752867341669}
Test Patient Data:  {'age': 29, 'cholesterol': 120, 'heart_rate': 60, 'family_history': 0, 'smoking': 0, 'triglycerides': 140, 'blood_pressure_sistolic': 110}
{'heart_atack_risk': 0.36072108743559167}
```

The 3% difference in heart attack risk is lower than what would be normally expected. That is mainly due to the quality of the training data. The data is not real data, it has been generated by ChatGPT for learning (human learning) purposes

## Feature Engineering and Training

### Redundant Features

In the original data there were features that are redundant.

Hemisphere and Continent features are dependent on country.

The Boolean feature obesity is redundant with BMI, obesity by definition implies a BMI greater or equal to 30.

All these 3 features Hemisphere, Continent and Obesity were eliminated.

### Dummification for Categorical Features

For the categorical features dummification was used to transform them in sets of Boolean features.
That was done for these two features diet and country.


### Features requiring extra transformation

One feature that required appropriate handling is "Blood Pressure". In the original data this comes as a pair of numeric values separated by / (example 120/65).

This feature was split into two numerical features: 'blood_pressure_sistolic' and 'blood_pressure_diastolic'

### Models and Training

Two different model were used:
* XGBoost Classifier
* Linear Regression Classifier

Both models were trained. The measured accuracy for both models is in the 64% -65%. No significant difference was found between these two models.

### Final Feature Selection

Several rounds of tests were run, gradually eliminating features that had very limited effect on the prediction accuracy.

As a final validation test, two test users one very healthy the other one quite unhealthy were used. 

The predict-test.py Python script contains this final validation test

The goal was to achieve a greater spread of predictions between the results for these two users. Based on this last validation the final set of features was decided. 

Here is the final set of features:
```
 #   Column                  
---  ------                  
 1   age                     
 2   cholesterol             
 3   heart_rate              
 4   family_history          
 5   smoking                 
 6   triglycerides           
 7   blood_pressure_sistolic
```
All that feature engineering and model selection was performed using this Jupyter notebook: mid-term-project.ipynb